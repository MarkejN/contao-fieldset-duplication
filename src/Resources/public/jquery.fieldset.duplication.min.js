!function(r){"use strict";r.fn.fieldsetDuplication=function(t){var s=r.extend({},{prepend:!1,buttonAdd:"+",buttonRemove:"&times;"},t);return r(this).each(function(t,e){var n=r(this),o=null,i=null,a=n.attr("class").split(/\s+/);r.each(a,function(t,e){if(e.match(/duplicate-fieldset-/))return i="."+e,!1});var u=function(){(o=r(i)).each(function(t,e){var n=r(this);n.removeClass("last"),n.removeClass("first"),0==t&&n.addClass("first"),t==o.length-1&&n.addClass("last"),d(n),n.hasClass("duplicate")?n.find(".duplication-buttons button.duplication-button--remove").show():n.find(".duplication-buttons button.duplication-button--remove").hide()})},l=function(t){t.find(".duplication-buttons button.duplication-button--add").off("click").on("click",function(t){return t.preventDefault(),function(t){if(!(50<=o.length)){var e=t.clone();e.find("input[name], select[name], textarea[name]").each(function(){var t=r(this);t.removeClass("error");var e=o.length+1,n=t.attr("id"),i=n+"_duplicate_"+e;t.attr("id",i);var a=t.attr("name")+"_duplicate_"+e;t.attr("name",a),t.closest(".widget").find('label[for="'+n+'"]').attr("for",i),t.val()&&t.val()!==t.attr("value")&&t.val(""),t.not("[checked]").prop("checked",!1)}),e.find("label").removeClass("error"),e.find("p.error").remove(),e.find(".widget").removeClass("error"),e.addClass("duplicate"),l(e),t.after(e),u(),r(document).trigger("fieldset-cloned",[e])}}(r(this).closest("fieldset")),!1}),t.hasClass("duplicate")&&t.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",function(t){var e;return t.preventDefault(),e=r(this).closest("fieldset"),1<o.length&&e.hasClass("duplicate")&&(e.remove(),u()),!1})},d=function(t){t.find(".duplication-buttons").remove();var e=r('<div class="duplication-buttons"></div>'),n=r('<button type="button" class="duplication-button duplication-button--add">'+s.buttonAdd+"</button>");e.append(n);var i=r('<button type="button" class="duplication-button duplication-button--remove">'+s.buttonRemove+"</button>");e.append(i),s.prepend?t.prepend(e):t.append(e),l(t)};u()}),this}}(jQuery);