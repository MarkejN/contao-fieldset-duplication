!function(f){"use strict";f.fn.fieldsetDuplication=function(t){var c=f.extend({},{prepend:!1,buttonAdd:"+",buttonRemove:"&times;"},t);return f(this).each(function(t,e){var n=f(this),i=null,a=null,d=null,u=0,o=n.attr("class").split(/\s+/);f.each(o,function(t,e){if(e.match(/duplicate-fieldset-/))return a="."+e,!1}),f.each(o,function(t,e){if(e.match(/duplicate-fieldset-maxRows-/))return d=e.substring("duplicate-fieldset-maxRows-".length),!1});function s(){(i=f(a)).each(function(t,e){var n=f(this);n.removeClass("last"),n.removeClass("first"),0==t&&n.addClass("first"),t==i.length-1&&n.addClass("last"),l(n),n.hasClass("duplicate")?n.find(".duplication-buttons button.duplication-button--remove").show():n.find(".duplication-buttons button.duplication-button--remove").hide()})}var r=function(t){t.find(".duplication-buttons button.duplication-button--add").off("click").on("click",function(t){return t.preventDefault(),function(l){if(null!=d&&i.length>=d)f(document).trigger("fieldset-clone-rejected",[l,i,d]);else{var t=l.clone();u++,t.find("input[name], select[name], textarea[name]").each(function(){var t=f(this);t.removeClass("error");var e=t.attr("id");if(void 0!==e){0<=(a=e.indexOf("_duplicate_"))&&(e=e.substr(0,a));var n=e+"_duplicate_"+u;t.closest(".widget").find('label[for="'+t.attr("id")+'"]').each(function(){var t=f(this);t.attr("for",n),void 0!==t.attr("id")&&t.attr("id",t.attr("id")+"_duplicate_"+u)}),t.attr("id",n)}var i=t.attr("name");if(void 0!==i){var a;0<=(a=i.indexOf("_duplicate_"))&&(i=i.substr(0,a));var d=i+"_duplicate_"+u;t.attr("name",d)}var o=t.attr("value");t.val()&&void 0!==o&&!1!==o&&(t.val()!==o||l.hasClass("duplicate-fieldset-donotcopy"))&&t.val(""),t.not("[checked]").prop("checked",!1)}),t.find("label").removeClass("error"),t.find("p.error").remove(),t.find(".widget").removeClass("error"),t.addClass("duplicate"),r(t),l.after(t),s(),null!=d&&i.length>=d&&i.each(function(t,e){var n=f(this);n.find(".duplication-button--add").addClass("disabled"),n.find(".duplication-button--add").attr("disabled","disabled")}),f(document).trigger("fieldset-cloned",[t])}}(f(this).closest("fieldset")),!1}),t.hasClass("duplicate")&&t.find(".duplication-buttons button.duplication-button--remove").off("click").on("click",function(t){return t.preventDefault(),function(t){1<i.length&&t.hasClass("duplicate")&&(t.remove(),s())}(f(this).closest("fieldset")),!1})},l=function(t){t.find(".duplication-buttons").remove();var e=f('<div class="duplication-buttons"></div>'),n=f('<button type="button" class="duplication-button duplication-button--add">'+c.buttonAdd+"</button>");e.append(n);var i=f('<button type="button" class="duplication-button duplication-button--remove">'+c.buttonRemove+"</button>");e.append(i),c.prepend?t.prepend(e):t.append(e),r(t)};s()}),this}}(jQuery);